<!DOCTYPE html>
<html>
  <head>
    <style>
      body { font-family: Arial, sans-serif; margin: 20px; }
      h2 { color: #333; }
      .sessions-container { margin-top: 20px; }
      .session-card {
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 15px;
        margin: 10px 0;
        background-color: #f9f9f9;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .session-info { flex: 1; }
      .session-info h3 { margin: 0 0 10px 0; }
      .hardware-details { color: #666; font-size: 14px; }
      button {
        background-color: #4CAF50;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
      }
      button:hover { background-color: #45a049; }
      .loading { color: #999; font-style: italic; }
      .error { color: #d9534f; }
    </style>
  </head>
  <body>
    <h2>RUNIT – Available Jupyter Sessions</h2>
    <div id="sessions" class="sessions-container">
      <p class="loading">Loading sessions...</p>
    </div>

    <script>
      async function loadSessions() {
        try {
          const res = await fetch(
            "https://runit-p5ah.onrender.com/renter/sessions"
          );

          if (!res.ok) {
            document.getElementById("sessions").innerHTML =
              '<p class="error">Failed to load sessions</p>';
            return;
          }

          const sessions = await res.json();

          if (sessions.length === 0) {
            document.getElementById("sessions").innerHTML =
              '<p class="error">No sessions available</p>';
            return;
          }

          const html = sessions
            .map(
              (session, index) =>
                `
            <div class="session-card">
              <div class="session-info">
                <h3>Provider ${index + 1}</h3>
                <div class="hardware-details">
                  <strong>GPU:</strong> ${session.hardware?.gpu || "N/A"} | 
                  <strong>RAM:</strong> ${session.hardware?.ram_gb || "?"}GB | 
                  <strong>Price:</strong> $${session.pricing?.hourlyUsd || "?"}​/hr
                </div>
              </div>
              <button onclick="connectSession('${session.accessToken}')">
                Connect
              </button>
            </div>
          `
            )
            .join("");

          document.getElementById("sessions").innerHTML = html;
        } catch (err) {
          console.error("Error loading sessions:", err);
          document.getElementById("sessions").innerHTML =
            '<p class="error">Error loading sessions</p>';
        }
      }

      async function connectSession(accessToken) {
        const url = `https://runit-p5ah.onrender.com/access/${accessToken}`;
        window.open(url, "_blank");
      }

      // Load sessions when page loads
      loadSessions();

      // Refresh sessions every 5 seconds
      setInterval(loadSessions, 5000);
    </script>
  </body>
</html>
